let dataTable;
let currentPage = 1;

export function putTableInfo(id) {
    const faturaData = {
        vatnumber: id,
        page: currentPage,
    };

    fetch("/tableinfo", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify(faturaData),
    })
        .then((response) => response.json())
        .then((data) => {
            checkDataTable(data);

            // If there are more pages, recursively fetch the next page after a delay
            if (currentPage <= data.last_page) {
                setTimeout(() => {
                    putTableInfo(id);
                }, 1000); // Adjust the delay (in milliseconds) as needed
            }
        })
        .catch((error) => {
            console.error("An error occurred:", error);
        });
}

function checkDataTable(data) {


    if (!dataTable) {
        dataTable = $("#example").DataTable();
    }

    if (data && data.data && data.data.length > 0) {
        // Add new data to the existing rows
        dataTable.rows.add(data.data.map(Object.values));
        // Update current page for the next request
        currentPage = data.current_page + 1;
        // Draw the DataTable after a short delay to ensure data is processed
        setTimeout(() => {
            dataTable.draw();
        }, 10); // Adjust the delay as needed
    } else {
        console.warn("Empty or invalid data received from the server");
        // Handle the case of empty or invalid data
    }
}

checkDataTable("");

export function checkIfisCkicked() {
    // Get the container element
    var clientsContainer = document.getElementById("clients");

    // Get all child elements with id 'clientsVatnumber'
    var clientVatElements =
        clientsContainer.querySelectorAll("#clientsVatnumber");

    // Add click event listener to each element
    clientVatElements.forEach(function (element) {
        element.addEventListener("click", function () {
            console.log(element.textContent + " lol");
            putTableInfo(element.textContent);
        });
    });
}
