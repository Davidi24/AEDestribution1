import { setDataTable } from "../Table/populateTable.min.js";
import { getClients } from "../SideBar/clients.min.js";
import { filterData } from "../Table/filterFunctionalities.min.js";
import { filter } from "../Table/filterTable.min.js";
import { search } from "../Table/search.min.js";
import { getID } from "../Table/populateTable.min.js";
import { putTableInfoFromCache } from "../Table/populateTable.min.js";
import { exportToExcel } from "../Table/Exportdata/exel.min.js";

var isClickeClintTable = false;

var rightPageContainer = document.querySelector(".content");
var createClientbutton = document.querySelector(".ClientButton");
let dataTable;
createClientbutton.addEventListener("click", () => {
    getViewData("/createClient");
    isClickeClintTable = false;
});

var getClientsInfo = document.querySelector(".noti-dot");
getClientsInfo.addEventListener("click", (e) => {
    if(!isClickeClintTable){
        getViewData("/gettable");
        getClients();

        isClickeClintTable = true;
    }
});

export function getViewData(url) {
    fetch(url, {
        method: "GET",
        headers: {
            "Content-Type": "application/json",
        },
    })
        .then((response) => {
            if (response.ok) {
                return response.json();
            } else if (response.status === 401) {
                // Incorrect password
                return response.json();
            } else {
                // Handle other response status codes or errors
                throw new Error("An error occurred");
            }
        })
        .then((data) => {
            if (data.message == NaN) {
                console.log(data);
            } else {
                rightPageContainer.innerHTML = data.message;
                dataTable = $("#example").DataTable();
                setDataTable(dataTable);
                addTableFunctionalities();
            }
        })
        .catch((error) => {
            console.error(error);
        });
}


export function addTableFunctionalities(){
    var filterbuttone = document.getElementById("filterButton");
    filterbuttone.addEventListener("click", () => {
        filterData();
    });

    var filterbuttone = document.getElementById("clearButton");
filterbuttone.addEventListener("click", () => {
    var id = getID();
    putTableInfoFromCache(id);
});

filter()
search()
const excelButton = document.getElementById('excel');
console.log(excelButton)
excelButton.addEventListener('click', ()=>{
    exportToExcel()
});
}

